= Формирование условия атрибутивного поиска

Условия атрибутивного поиска формируются по схеме: _<Режим поискового запроса><Название поля><Логическое условие><Атрибут: Значение поля/Поисковое слово><Является ли атрибут параметром>_, которые указываются в полях *Поле*, *Условие*, *Значение*/*Поисковое слово* и *Параметр* соответственно.

* *Поле* выбирается из списка имеющихся у карточки полей (например, `Дата регистрации`) в окне *Выбор поля*.
* *Условие* -- любое условие из списка доступных условий (например, `Содержит`, `Равно`, `Не равно`). Набор доступных условий зависит от выбранного поля.
* В качестве атрибута может быть указано значение поля (например, для поля *Фамилия* значение "Иванов") или поисковое слово (для некоторых полей).
+
И значение, и поисковое слово могут являться _параметром_, то есть быть не зафиксированными жестко; тогда при каждом выполнении поиска у пользователя будет запрошено подтверждение указанного значения.

Если заданы несколько условий атрибутивного поиска, то их можно группировать при помощи логических операторов *И* или *ИЛИ*, в том числе допускается создание запросов с объединением нескольких секций на всех уровнях дерева условий (включая самый верхний).

Запрос к типу карточки может строиться по любому из следующих режимов:

* как набор запросов к секциям;
* как набор групп запросов к секциям, при этом группа не может одновременно включать и запросы к секции, и подгруппы.

Чтобы настроить условие атрибутивного поиска, выполните следующие действия:

. Откройте окно *Расширенный поиск* и перейдите на вкладку *Атрибутивный*.
+
image::Windows_Attributive_Search_empty.png[Вкладка "Атрибутивный" окна "Расширенный поиск"]
. Выберите тип искомой карточки и ее поле: #
* нажмите кнопку *Поле*;
* в открывшемся окне *Выбор поля* выберите из списка название поля.
+
image::Field_Selection.png[Окно "Выбор поля"]
+
[NOTE]
====
Важно различать поля *Дата создания* и *Дата регистрации*. Зачастую даты в этих полях могут совпадать, но не всегда. Поле *Дата создания* заполняется автоматически при создании карточки. Поле *Дата регистрации* изменяется вручную и может предшествовать дате создания, так как регистрация могла быть проведена ранее (например, в бумажной форме).
====
. Определите режим работы поискового запроса:
* как набор групп запросов к секциям (см. пункт xref:Search_Multiple_Values_group_of_Section.adoc[Организация поиска в наборе групп запросов к секциям]);
* как набор запросов к секциям (см. шаги 4-6 ниже, а также раздел xref:Search_Multiple_Values_one_Section.adoc[Организация поиска по нескольким значениям одной секции]).
. После выбора поля в раскрывающемся списке поля *Условие* будет отображаться список всех условий, применимых к указанному типу поля. Выберите условие, накладываемое на значение поля:
+
Все существующие в системе условия представлены в нижеследующем списке; для каждого конкретного типа полей доступна только часть из приведенных в нем операций:

* _Равно_: введите значение, в точности равное искомому.
* _Не равно_: введите значение, которого не должно быть в искомом значении (например, найти документы, автором которых не является определенный пользователь).
* _Начинается с_: введите значение, с которого начинается искомый элемент.
* _Заканчивается на_: введите значение, на которое заканчивается искомый элемент. Содержит: введите значение, которое содержится в искомом элементе.
* _Не содержит_: введите значение, которое не содержится в искомом элементе.
* _Значение задано_: поиск осуществляется по всем непустым полям, независимо от их значений.
* _Значение не задано_: поиск осуществляется без заданного значения.
* _Родитель для_: поиск осуществляется вниз по иерархии, учитывая значение текущего и всех дочерних элементов.
* _Подчиненный для_: поиск осуществляется вверх по иерархии, учитывая значение текущего и всех родительских элементов.
+
В случае использования параметрического поиска для динамических полей с приблизительными типами данных, например, с типом float и real, а также типом decimal, следует использовать операции разностного сравнения. Данное ограничение связано с точностью хранения значений для данных типов. Использование большого количества знаков после запятой не позволит выполнить поиск по точному совпадению значений. Описание использования типов можно посмотреть http://technet.microsoft.com/ru-ru/library/ms187912%28v=sql.105%29.aspx[здесь].
. Укажите атрибут, по которому будут отбираться карточки при проведении поиска.
* Если в качестве атрибута выступает некое конкретное значение, то его следует ввести в поле, расположенное справа от кнопки * Значение*. Способ ввода значения зависит от типа указанного поля, при этом:
** значения полей карточек документов, представляющих собой ссылки на элементы справочников, выбираются из соответствующих справочников. Например, значения для полей *Автор* или *Регистратор* выбираются из _Справочника сотрудников_;
** при выборе поля типа _RefId_, ссылающееся на строку _Конструктора справочников_, справа от поля *Значение* появится дополнительная кнопка *Узел*, позволяющая наложить ограничение поиска по узлу. Если настройка указана, при выборе значений из _Конструктора справочников_ в соответствующем поле карточки конструктор будет открываться с позиционированием на указанном узле. Остальные узлы при этом будут скрыты, дочерние узлы по отношению к выбранному останутся доступными. В случае использования быстрого поиска будет применяться режим _Выбранный+дочерние_.
+
При нажатии на кнопку *Узел* раскрывается контекстное меню, включающее опции:
*** _Выбрать узел_ - будет открыто окно для выбора узла _Конструктора справочников_. После выбора узла надпись на кнопке будет изменена на название выбранного узла;
*** _Очистить_ - выбранное значение узла, задающее ограничение выбора, будет удалено. Название кнопки будет изменено на *Узел*.
+
image::Search_Attribute_Node.png[Выбор узла Конструктора справочников]
** если при работе с карточками в качестве поля, в котором будет производиться поиск, выбрано *Значение свойства* необходимо выбрать тип свойства. При этом справа от поля *Значение* появится дополнительная кнопка *Тип*, из выпадающего списка которой следует выбрать тип данных свойства -- строковое, целочисленное, сотрудник и др.
+
image::Selecting_Type_of_Property_Values.png[Выбор типа значений свойства]
* В случае использования в качестве атрибута *Поискового слова* поиск будет осуществляться по выбранному поисковому слову. Для его включения в поисковый запрос следует выполнить действия:
** нажать кнопку *Значение>>* и выбрать строку _Поисковое слово_;
+
image::Selection_of_Values_of_Field.png[Выбор атрибута "Поисковое слово"]
** из раскрывающегося списка выбрать нужное поисковое слово.
+
[NOTE]
====
Поисковые слова находятся в базе {dv} и не редактируются. Поисковые слова могут быть заданы только для тех полей, которые могут принимать значения даты и времени, имен сотрудников или их учетных записей, названий подразделений.

В качестве служебных слов со значениями для полей даты и времени используются:

*** *Сегодня* -- обозначает текущую дату;
*** *Сейчас* -- обозначает текущий момент времени.

Условие со служебным словом может быть задано в формате: *Сегодня +/-- <количество дней>* ; *Сейчас +/-- <количество часов>* .

Служебными словами для полей, содержащих значения имен сотрудников, являются:

*** *Я* -- обозначает имя пользователя, создающего запрос;
*** *Руководитель* -- обозначает имя руководителя текущего пользователя, указанного в _Справочнике сотрудников_.

Кроме того, ряд служебных слов обозначает лиц, для которых в справочнике сотрудников "Я" указан в качестве заместителя. Служебные слова этой группы не могут являться параметром. См. xref:AttributiveSearch_SearchWords.adoc[Поисковые слова для полей с именами сотрудников].
====
* {blank}
+
Использование атрибута *Параметр* позволяет сделать строку поиска не фиксированной жестко: при каждом выполнении поиска у пользователя будет запрошено подтверждение указанного значения. Для включения этого атрибута в поисковый запрос выполните действия:

** установите флаг *Параметр*; при этом рядом с флагом откроется поле, в котором отображается _имя параметра_;
** чтобы выбрать параметр из числа уже существующих для данного типа данных, нажмите на стрелку в правой части поля и выберите значение из выпадающего списка;
** при необходимости измените _имя параметра_ на менее общее и более значимое (по умолчанию оно совпадает с названием поля);
+
[NOTE]
====
Если параметром является поисковое слово, то при выполнении поиска в окне *Параметры поиска* (окно задания значений параметрических условий) будет отображаться уже вычисленное значение.
====
. Чтобы добавить сформированное условие атрибутивного поиска в фильтр, нажмите кнопку *Добавить*.
. Чтобы изменить или удалить условие атрибутивного поиска, выделите в разделе *Условия* интересующий элемент и нажмите кнопку *Изменить* или кнопку *Удалить* соответственно. Чтобы удалить все условия поиска, нажмите кнопку *Очистить*.
