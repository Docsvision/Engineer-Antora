= Формирование условия атрибутивного поиска

Условия атрибутивного поиска формируются по схеме: [.keyword .parmname]_<Режим поискового запроса><Название поля><Логическое условие><Атрибут: Значение поля/Поисковое слово><Является ли атрибут параметром>_, которые указываются в полях [.keyword]*Поле*, [.keyword]*Условие*, [.keyword]*Значение*/[.keyword]*Поисковое слово* и [.keyword]*Параметр* соответственно.

* [.keyword]*Поле* выбирается из списка имеющихся у карточки полей (например, [.kbd .ph .userinput]`Дата регистрации`) в окне [.keyword .wintitle]*Выбор поля*.
* [.keyword]*Условие* – любое условие из списка доступных условий (например, [.kbd .ph .userinput]`Содержит`, [.kbd .ph .userinput]`Равно`, [.kbd .ph .userinput]`Не равно`). Набор доступных условий зависит от выбранного поля.
* В качестве атрибута может быть указано значение поля (например, для поля [.keyword]*Фамилия* значение «Иванов») или поисковое слово (для некоторых полей).
+
И значение, и поисковое слово могут являться [.keyword .parmname]_параметром_, то есть быть не зафиксированными жестко; тогда при каждом выполнении поиска у пользователя будет запрошено подтверждение указанного значения.

Если заданы несколько условий атрибутивного поиска, то их можно группировать при помощи логических операторов [.keyword]*И* или [.keyword]*ИЛИ*, в том числе допускается создание запросов с объединением нескольких секций на всех уровнях дерева условий (включая самый верхний).

Запрос к типу карточки может строиться по любому из следующих режимов:

* как набор запросов к секциям;
* как набор групп запросов к секциям, при этом группа не может одновременно включать и запросы к секции, и подгруппы.

Чтобы настроить условие атрибутивного поиска, выполните следующие действия:

. [.ph .cmd]#Откройте окно [.keyword .wintitle]*Расширенный поиск* и перейдите на вкладку [.keyword]*Атрибутивный*.#
+
image::img/Windows_Attributive_Search_empty.png[[.fig--title-label]##Рис. 1. ##Вкладка "Атрибутивный" окна "Расширенный поиск"]
. [.ph .cmd]#Выберите тип искомой карточки и ее поле: #
* нажмите кнопку [.ph .uicontrol]*Поле*;
* в открывшемся окне [.keyword .wintitle]*Выбор поля* выберите из списка название поля.
+
image::img/Field_Selection.png[[.fig--title-label]#Рис. 2. # Окно "Выбор поля"]
+
[NOTE]
====
[.note__title]#Прим.:#

Важно различать поля [.keyword .wintitle]*Дата создания* и [.keyword .wintitle]*Дата регистрации*. Зачастую даты в этих полях могут совпадать, но не всегда. Поле [.keyword .wintitle]*Дата создания* заполняется автоматически при создании карточки. Поле [.keyword .wintitle]*Дата регистрации* изменяется вручную и может предшествовать дате создания, так как регистрация могла быть проведена ранее (например, в бумажной форме).
====
. [.ph .cmd]#Определите режим работы поискового запроса:#
* как набор групп запросов к секциям (см. пункт xref:Search_Multiple_Values_group_of_Section.adoc[Организация поиска в наборе групп запросов к секциям]);
* как набор запросов к секциям (см. шаги 4-6 ниже, а также раздел xref:Search_Multiple_Values_one_Section.adoc[Организация поиска по нескольким значениям одной секции]).
. [.ph .cmd]#После выбора поля в раскрывающемся списке поля [.ph .uicontrol]*Условие* будет отображаться список всех условий, применимых к указанному типу поля. Выберите условие, накладываемое на значение поля:#
+
Все существующие в системе условия представлены в нижеследующем списке; для каждого конкретного типа полей доступна только часть из приведенных в нем операций:

* [.keyword .parmname]_Равно_: введите значение, в точности равное искомому.
* [.keyword .parmname]_Не равно_: введите значение, которого не должно быть в искомом значении (например, найти документы, автором которых не является определенный пользователь).
* [.keyword .parmname]_Начинается с_: введите значение, с которого начинается искомый элемент.
* [.keyword .parmname]_Заканчивается на_: введите значение, на которое заканчивается искомый элемент. Содержит: введите значение, которое содержится в искомом элементе.
* [.keyword .parmname]_Не содержит_: введите значение, которое не содержится в искомом элементе.
* [.keyword .parmname]_Значение задано_: поиск осуществляется по всем непустым полям, независимо от их значений.
* [.keyword .parmname]_Значение не задано_: поиск осуществляется без заданного значения.
* [.keyword .parmname]_Родитель для_: поиск осуществляется вниз по иерархии, учитывая значение текущего и всех дочерних элементов.
* [.keyword .parmname]_Подчиненный для_: поиск осуществляется вверх по иерархии, учитывая значение текущего и всех родительских элементов.
+
В случае использования параметрического поиска для динамических полей с приблизительными типами данных, например, с типом float и real, а также типом decimal, следует использовать операции разностного сравнения. Данное ограничение связано с точностью хранения значений для данных типов. Использование большого количества знаков после запятой не позволит выполнить поиск по точному совпадению значений. Описание использования типов можно посмотреть http://technet.microsoft.com/ru-ru/library/ms187912%28v=sql.105%29.aspx[здесь].
. [.ph .cmd]#Укажите атрибут, по которому будут отбираться карточки при проведении поиска.#
* Если в качестве атрибута выступает некое конкретное значение, то его следует ввести в поле, расположенное справа от кнопки [.ph .uicontrol]* Значение*. Способ ввода значения зависит от типа указанного поля, при этом:
** значения полей карточек документов, представляющих собой ссылки на элементы справочников, выбираются из соответствующих справочников. Например, значения для полей [.ph .uicontrol]*Автор* или [.ph .uicontrol]*Регистратор* выбираются из [.dfn .term]_Справочника сотрудников_;
** при выборе поля типа [.dfn .term]_RefId_, ссылающееся на строку [.dfn .term]_Конструктора справочников_, справа от поля [.keyword]*Значение* появится дополнительная кнопка [.keyword]*Узел*, позволяющая наложить ограничение поиска по узлу. Если настройка указана, при выборе значений из [.dfn .term]_Конструктора справочников_ в соответствующем поле карточки конструктор будет открываться с позиционированием на указанном узле. Остальные узлы при этом будут скрыты, дочерние узлы по отношению к выбранному останутся доступными. В случае использования быстрого поиска будет применяться режим [.keyword .parmname]_Выбранный+дочерние_.
+
При нажатии на кнопку [.keyword]*Узел* раскрывается контекстное меню, включающее опции:
*** [.keyword .parmname]_Выбрать узел_ - будет открыто окно для выбора узла [.dfn .term]_Конструктора справочников_. После выбора узла надпись на кнопке будет изменена на название выбранного узла;
*** [.keyword .parmname]_Очистить_ - выбранное значение узла, задающее ограничение выбора, будет удалено. Название кнопки будет изменено на [.keyword]*Узел*.
+
image::img/Search_Attribute_Node.png[[.fig--title-label]##Рис. 3. ##Выбор узла Конструктора справочников]
** если при работе с карточками в качестве поля, в котором будет производиться поиск, выбрано [.keyword]*Значение свойства* необходимо выбрать тип свойства. При этом справа от поля [.ph .uicontrol]*Значение* появится дополнительная кнопка [.ph .uicontrol]*Тип*, из выпадающего списка которой следует выбрать тип данных свойства – строковое, целочисленное, сотрудник и др.
+
image::img/Selecting_Type_of_Property_Values.png[[.fig--title-label]#Рис. 4. # Выбор типа значений свойства]
* В случае использования в качестве атрибута [.keyword]*Поискового слова* поиск будет осуществляться по выбранному поисковому слову. Для его включения в поисковый запрос следует выполнить действия:
** нажать кнопку [.ph .uicontrol]*Значение>>* и выбрать строку [.keyword .parmname]_Поисковое слово_;
+
image::img/Selection_of_Values_of_Field.png[[.fig--title-label]##Рис. 5. ##Выбор атрибута "Поисковое слово"]
** из раскрывающегося списка выбрать нужное поисковое слово.
+
[NOTE]
====
[.note__title]#Прим.:#

Поисковые слова находятся в базе Docsvision и не редактируются. Поисковые слова могут быть заданы только для тех полей, которые могут принимать значения даты и времени, имен сотрудников или их учетных записей, названий подразделений.

В качестве служебных слов со значениями для полей даты и времени используются:

*** *Сегодня* – обозначает текущую дату;
*** *Сейчас* – обозначает текущий момент времени.

Условие со служебным словом может быть задано в формате: *Сегодня +/– <количество дней>* ; *Сейчас +/– <количество часов>* .

Служебными словами для полей, содержащих значения имен сотрудников, являются:

*** *Я* – обозначает имя пользователя, создающего запрос;
*** *Руководитель* – обозначает имя руководителя текущего пользователя, указанного в [.dfn .term]_Справочнике сотрудников_.

Кроме того, ряд служебных слов обозначает лиц, для которых в справочнике сотрудников «Я» указан в качестве заместителя. Служебные слова этой группы не могут являться параметром. См. xref:AttributiveSearch_SearchWords.adoc[Поисковые слова для полей с именами сотрудников].
====
* {blank}
+
Использование атрибута [.keyword]*Параметр* позволяет сделать строку поиска не фиксированной жестко: при каждом выполнении поиска у пользователя будет запрошено подтверждение указанного значения. Для включения этого атрибута в поисковый запрос выполните действия:

** установите флаг [.ph .uicontrol]*Параметр*; при этом рядом с флагом откроется поле, в котором отображается [.keyword .parmname]_имя параметра_;
** чтобы выбрать параметр из числа уже существующих для данного типа данных, нажмите на стрелку в правой части поля и выберите значение из выпадающего списка;
** при необходимости измените [.keyword .parmname]_имя параметра_ на менее общее и более значимое (по умолчанию оно совпадает с названием поля);
+
[NOTE]
====
[.note__title]#Прим.:# Если параметром является поисковое слово, то при выполнении поиска в окне [.keyword .wintitle]*Параметры поиска* (окно задания значений параметрических условий) будет отображаться уже вычисленное значение.
====
. [.ph .cmd]#Чтобы добавить сформированное условие атрибутивного поиска в фильтр, нажмите кнопку [.ph .uicontrol]*Добавить*. #
. [.ph .cmd]#Чтобы изменить или удалить условие атрибутивного поиска, выделите в разделе [.keyword]*Условия* интересующий элемент и нажмите кнопку [.ph .uicontrol]*Изменить* или кнопку [.ph .uicontrol]*Удалить* соответственно. Чтобы удалить все условия поиска, нажмите кнопку [.ph .uicontrol]*Очистить*. #

* *xref:../topics/AttributiveSearch_SearchWords.adoc[Поисковые слова для полей с именами сотрудников]* +

*На уровень выше:* xref:../topics/Search_Setting_Attributive_Search.adoc[Формирование запроса для атрибутивного поиска]
