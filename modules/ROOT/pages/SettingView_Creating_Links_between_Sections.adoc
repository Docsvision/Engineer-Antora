= Определение связей между разделами

В отличие от рядового пользователя, администратор Docsvision может расширить список доступных для вывода в представлении полей, указывая при его создании связи между разделами карточек.

На рисунке ниже представлено диалоговое окно [.keyword .wintitle]*Настройка элементов представления*, открытое администратором Docsvision. Кроме поля [.keyword]*Колонки представления*, имеющегося в окне, открытом рядовым пользователем, здесь расположено поле [.keyword]*Присоединенные разделы*, в котором можно присоединить к ведущему разделу карточки некоторый другой раздел этой же или другой карточки.

image::img/Setting_Views_Items.png[[.fig--title-label]#Рис. 1. # Окно "Настройка элементов представления", открытое администратором Docsvision]

Элементы, источник данных которых хранится в ведущем разделе и не является ссылочным полем (на рисунке  это элементы колонок [.keyword]*Название*, [.keyword]*Дата регистрации* и [.keyword]*Содержание*), определяются так же, как это описано в параграфе xref:SettingView_Selection_Information.adoc[Определение информации, предназначенной для вывода в представлении].

Далее подробно опишем, каким образом настраивается элемент представления, источник данных которого расположен не в ведущем разделе и, следовательно, нуждается в присоединении.

По кнопке [.ph .uicontrol]*Добавить*, расположенной справа от поля [.keyword]*Присоединенные разделы*, открывается диалог настройки дополнительных разделов, необходимых для отображения данных в представлении.

image::img/Attached_Section.png[[.fig--title-label]#Рис. 2. # Окно "Присоединенный раздел"]

В полях окна [.keyword .wintitle]*Присоединенный раздел* прежде всего указывается [.keyword]*Оригинальный раздел* – тот раздел, поле которого будет использоваться в качестве ключа для связи с другим разделом. Оригинальный раздел выбирается в окне [.keyword .wintitle]**Выбор раздел##а, открывающемся по кнопке image:img/Buttons/Select.png[image] справа от поля. По умолчанию в качестве оригинального всегда доступен ведущий раздел; кроме того, доступны и все разделы, присоединенные к ведущему ранее (но при создании этого же представления).

image::img/Select_Item_Adm.png[[.fig--title-label]#Рис. 3. # Окно "Выбор раздела"]

После указания оригинального раздела указывается[.keyword]** Оригинальное поле##, данные из которого являются ссылкой к присоединяемому разделу. После этого поля [.keyword]*Присоединяемый раздел* и [.keyword]*Присоединяемое поле* заполняются автоматически теми значениями, которые соответствуют настраиваемой связи, а поле [.keyword]*Псевдоним* – предлагаемым названием присоединяемого раздела, но при необходимости значения этих полей пользователь может изменить.

Среди полей, доступных в списках [.keyword]*Оригинальное поле* и [.keyword]*Присоединяемое поле*, всегда есть системные поля:

* [.keyword]*InstanceID* – идентификатор карточки;
* [.keyword]*ParentRowID* – идентификатор родительской строки;
* [.keyword]*ParentTreeRowID* – идентификатор родительской строки в дереве;
* [.keyword]*RowID* – идентификатор строки карточки;
* [.keyword]*SysRowTimestamp* – служебное поле.

[NOTE]
====
[.note__title]#Прим.:# При присоединении к оригинальному разделу другого раздела этой же карточки в полях *Оригинальное поле* и *Присоединяемое поле* должен быть выбран пункт *InstanceID*.
====

Поля *Присоединяемый раздел* и *Присоединяемое поле* имеет смысл заполнять вручную в том случае, когда к ведущему разделу нужно присоединить не секцию какой-либо карточки, а таблицу базы данных Docsvision и ее поле (например, таким способом можно вывести в представлении все ссылки из входящих документов). При таком присоединении необходимо обратить внимание на следующую особенность: если тип поля, по которому происходит соединение, не uniqueidentifier, то после создания представления нужно:

. xref:ViewExport.adoc[Выгрузить представление] в файл XML.
. Изменить выгруженный файл, указав в секции JoinDef у параметра DestFieldType (тип поля), его фактическое значение. Например:
+
[source,pre,codeblock]
----
<JoinDef Alias="UserJoin_1" SourceAlias="Main" SourceField="AccountName" DestField="AccountName" TableName="dvsys_users" DestFieldType="unistring"/>
----
+
Возможные типы полей: Int, Bool, DateTime, UniqueId, String, Unistring, Float, Decimal, Binary.
. xref:ViewImport.adoc[Импортировать представление] из изменённого файла.

После создания присоединенного раздела данные из него могут быть указаны в качестве элемента представления. Для этого нужно вернуться к полю [.keyword]*Колонки представления*, выделить нужную строчку и двойным щелчком мыши открыть окно [.keyword .wintitle]*Настройка данных колонки*. Далее в этом окне в качестве [.keyword]*Типа данных* следует указать [.keyword .parmname]_поле раздела_ и по кнопке поля [.keyword]*Элемент* открыть окно [.keyword .wintitle]*Выбор раздела*. Теперь в этом окне можно выбрать поле, из которого будет считываться информация; для выбора доступны поля оригинального и всех присоединенных разделов.

На рисунке представлен пример выбора поля для настройки элемента представления, отображающегося в колонке [.keyword]*Вид*. В качестве раздела указывается присоединенный раздел [.keyword .parmname]_DocumentTypes_1_ (название псевдонима по умолчанию; псевдоним виден в списке доступных разделов). Далее в этом разделе выбирается нужное поле (в данном случае – [.kbd .ph .userinput]`Название` вида документа).

image::img/Select_Item_Name.png[[.fig--title-label]#Рис. 4. # Окно "Выбор раздела"]

Флажки окна [.keyword .wintitle]*Присоединенный раздел* позволяют выводить в представлении данные иерархии:

* [.ph .uicontrol]*Раскрывать иерархию присоединяемого раздела* – основной флаг, при установке которого становятся доступными остальные флаги секции;
* при установленном флаге [.ph .uicontrol]*Присоединять родительские элементы иерархии* иерархия будет раскрыта в сторону родительских элементов, при снятом – в сторону дочерних;
* установка флага [.ph .uicontrol]*Выводить только корневой родительский элемент* позволяет вывести в представление только корневой элемент иерархии, минуя все промежуточные (например, для элемента [.keyword .parmname]_Сотрудник_ в представлении будет выведен элемент [.keyword .parmname]_Организация_ без элемента [.keyword .parmname]_Подразделение_);
* счетчик, активизирующийся при установленном флаге [.ph .uicontrol]*Ограничивать вывод иерархии уровнем <...>*, позволяет указать уровень выводимых в представление узлов иерархии относительно текущего элемента.

В поле [.keyword]*Условие на основной раздел представления* окна [.keyword .wintitle]*Настройка элементов представления* определяются условия вывода данных ведущего (основного) раздела карточки в представлении. Задаются эти условия так же, как и описанные далее условия присоединения раздела.

*На уровень выше:* xref:../topics/SettingView_Setting_AdminDV.adoc[Дополнительные возможности настройки]
