= Формирование условия атрибутивного поиска

Условия атрибутивного поиска формируются по схеме: *<Режим поискового запроса><Название поля><Логическое условие><Атрибут: Значение поля/Поисковое слово><Является ли атрибут параметром>*, которые указываются в полях _Поле_, _Условие_, _Значение_/_Поисковое слово_ и _Параметр_ соответственно.

* _Поле_ -- выбирается из списка имеющихся у карточки полей (например, _Дата регистрации_) в окне _Выбор поля_.
* _Условие_ -- любое условие из списка доступных условий (например, *_Содержит_*, *_Равно_*, *_Не равно_*). Набор доступных условий зависит от выбранного поля.
* В качестве атрибута может быть указано значение поля (например, для поля _Фамилия_ значение "Иванов") или поисковое слово (для некоторых полей).
+
И значение, и поисковое слово могут являться _параметром_, то есть не быть жестко зафиксированными. Тогда при каждом выполнении поиска у пользователя будет запрошено подтверждение указанного значения.

Если заданы несколько условий атрибутивного поиска, то их можно группировать при помощи логических операторов `И` или `ИЛИ`, в том числе допускается создание запросов с объединением нескольких секций на всех уровнях дерева условий (включая самый верхний).

.Запрос к типу карточки может строиться по любому из следующих режимов:
* Как набор запросов к секциям.
* Как набор групп запросов к секциям, при этом группа не может одновременно включать и запросы к секции, и подгруппы.

.Чтобы настроить условие атрибутивного поиска:
. Откройте окно _Расширенный поиск_ и перейдите на вкладку _Атрибутивный_.
+
.[Вкладка "Атрибутивный" окна "Расширенный поиск"
image::Windows_Attributive_Search_empty.png[Вкладка "Атрибутивный" окна "Расширенный поиск"]
+
. Выберите тип искомой карточки и ее поле:
* Нажмите кнопку *Поле*;
* В открывшемся окне _Выбор поля_ выберите из списка название поля.
+
.Окно "Выбор поля"
image::Field_Selection.png[Окно "Выбор поля"]
+
[NOTE]
====
Важно различать поля _Дата создания_ и _Дата регистрации_. Зачастую даты в этих полях могут совпадать, но не всегда. Поле _Дата создания_ заполняется автоматически при создании карточки. Поле _Дата регистрации_ изменяется вручную и может предшествовать дате создания, так как регистрация могла быть проведена ранее (например, в бумажной форме).
====
+
. Определите режим работы поискового запроса:
+
* Как набор групп запросов к секциям (см. пункт xref:attributive-multiple-groups.adoc[Организация поиска в наборе групп запросов к секциям]);
* Как набор запросов к секциям (см. шаги 4-6 ниже, а также раздел xref:attributive-multiple-values.adoc[Организация поиска по нескольким значениям одной секции]).
+
. После того как было выбрано поле, в раскрывающемся списке _Условие_ отобразится список всех условий, применимых к указанному типу поля.
+
Все существующие в системе условия представлены в списке ниже. Для каждого конкретного типа полей доступна только часть из приведенных в нем операций:
+
* *_Равно_*: введите значение, которое должно в точности равняться искомому.
* *_Не равно_*: введите значение, которого не должно быть в искомом. Таким образом, например, можно найти документы, автором которых не является определенный пользователь.
* *_Начинается с_*: введите начало искомого значения.
* *_Заканчивается на_*: введите окончание искомого значения.
* *_Содержит_*: введите значение, которое содержится в искомом.
* *_Не содержит_*: введите значение, которое не содержится в искомом.
* *_Значение задано_*: поиск будет осуществляться по всем непустым полям, независимо от их значений.
* *_Значение не задано_*: поиск будет осуществляться без заданного значения.
* *_Родитель для_*: поиск будет осуществляться вниз по иерархии с учётом значения текущего и всех дочерних элементов.
* *_Подчиненный для_*: поиск будет осуществляться вверх по иерархии с учётом значения текущего и всех родительских элементов.
+
****
Если параметрический поиск используется для динамических полей с приблизительными типами данных, например, с типом `float` и `real`, а также типом `decimal`, следует использовать операции разностного сравнения.

Данное ограничение связано с точностью хранения значений для данных типов. Использование большого количества знаков после запятой не позволит выполнить поиск по точному совпадению значений. Описание использования типов можно посмотреть http://technet.microsoft.com/ru-ru/library/ms187912%28v=sql.105%29.aspx[здесь].
****
+
. Укажите атрибут, по которому будут отбираться карточки при проведении поиска.
+
* Если в качестве атрибута выступает конкретное значение, его следует ввести в поле, расположенное справа от кнопки *Значение*. Способ ввода значения зависит от типа указанного поля, при этом:
** Значения полей карточек документов, представляющих собой ссылки на элементы справочников, выбираются из соответствующих справочников. Например, значения для полей _Автор_ или _Регистратор_ выбираются из _Справочника сотрудников_.
** При выборе поля типа `RefId`, ссылающееся на строку _Конструктора справочников_, справа от поля _Значение_ появится дополнительная кнопка *Узел*. Кнопка позволяет наложить ограничение поиска по узлу.
+
****
Если настройка указана, при выборе значений из _Конструктора справочников_ в соответствующем поле карточки конструктор будет открываться с позиционированием на указанном узле. Остальные узлы при этом будут скрыты. Дочерние узлы по отношению к выбранному останутся доступными. В случае использования быстрого поиска будет применяться режим _Выбранный+дочерние_.

.При нажатии на кнопку "Узел" раскрывается контекстное меню, включающее опции:
* _Выбрать узел_ -- будет открыто окно для выбора узла _Конструктора справочников_. После выбора узла надпись на кнопке будет изменена на название выбранного узла.
* _Очистить_ -- выбранное значение узла, задающее ограничение выбора, будет удалено. Название кнопки будет изменено на *Узел*.

.Выбор узла Конструктора справочников
image::Search_Attribute_Node.png[Выбор узла Конструктора справочников]
****
+
** Если при работе с карточками в качестве поля, в котором будет производиться поиск, выбрано *_Значение свойства_* необходимо выбрать тип свойства. При этом справа от поля _Значение_ появится дополнительная кнопка *Тип*. Из выпадающего списка кнопки следует выбрать тип данных свойства -- строковое, целочисленное, сотрудник и др.
+
.Выбор типа значений свойства
image::Selecting_Type_of_Property_Values.png[Выбор типа значений свойства]
+
* Если в качестве атрибута используется *_Поисковое слово_*, поиск будет осуществляться по выбранному поисковому слову.
+
.Чтобы включить поисковое слово в запрос:
****
.. Нажмите кнопку *Значение >>* и выберите вариант *_Поисковое слово_*.
+
.Выбор атрибута "Поисковое слово"
image::Selection_of_Values_of_Field.png[Выбор атрибута "Поисковое слово"]
+
.. Из раскрывающегося списка выберите нужное поисковое слово.
+
NOTE: Поисковые слова находятся в базе {dv} и не редактируются. Поисковые слова могут быть заданы только для полей, которые принимают значения даты и времени, имен сотрудников или их учетных записей, названий подразделений.
+
--
.В качестве служебных слов со значениями для полей даты и времени используются:
* *_Сегодня_* -- обозначает текущую дату;
* *_Сейчас_* -- обозначает текущий момент времени.
+
Условие со служебным словом может быть задано в формате: *Сегодня +/- <количество дней>* или *Сейчас +/- <количество часов>*.
--
+
--
.Служебными словами для полей, содержащих значения имен сотрудников, являются:
* *_Я_* -- обозначает имя пользователя, выполнившего запрос.
* *_Руководитель_* -- обозначает имя руководителя пользователя, указанного в _Справочнике сотрудников_.
--
+
Кроме того, ряд служебных слов обозначает лиц, для которых в справочнике сотрудников *_Я_* указан в качестве заместителя. Служебные слова этой группы не могут являться параметром. См. xref:attributive-words.adoc[Поисковые слова для полей с именами сотрудников].
****
+
* Если в качестве атрибута используется `*Параметр*`, это позволяет не делать строку поиска жёстко фиксированной: при каждом выполнении поиска у пользователя будет запрошено подтверждение указанного значения.
+
.Чтобы включить использование "Параметра" в поисковом запросе:
****
.. Установите флаг `*Параметр*`, чтобы рядом с флагом отобразить поле с _именем параметра_.
.. Выберите уже существующий параметр из выпадающего списка.
.. При необходимости измените _имя параметра_ на более значимое (по умолчанию оно совпадает с названием поля).
+
[NOTE]
====
Если параметром является поисковое слово, то при выполнении поиска в окне _Параметры поиска_ (окно задания значений параметрических условий) будет отображаться уже вычисленное значение.
====
****
+
. Чтобы добавить сформированное условие атрибутивного поиска в фильтр, нажмите кнопку *Добавить*.
. Чтобы изменить или удалить условие атрибутивного поиска, выделите в разделе *Условия* интересующий элемент и нажмите кнопку *Изменить* или кнопку *Удалить* соответственно.
. Чтобы удалить все условия поиска, нажмите кнопку *Очистить*.
